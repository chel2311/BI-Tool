const S=["#005BAB","#FF961C","#00A86B","#E63946","#457B9D","#2A9D8F","#E9C46A","#F4A261","#264653","#A8DADC"],I={none:"そのまま",year:"年",quarter:"四半期",month:"月",week:"週",day:"日",weekday:"曜日",hour:"時"},P=["日","月","火","水","木","金","土"];function U(a,r){if(!a||r==="none")return a;let e;if(a instanceof Date?e=a:typeof a=="number"?a>25569&&a<5e4?e=new Date((a-25569)*86400*1e3):e=new Date(a):e=new Date(a),isNaN(e.getTime()))return a;switch(r){case"year":return`${e.getFullYear()}年`;case"quarter":const n=Math.floor(e.getMonth()/3)+1;return`${e.getFullYear()}年Q${n}`;case"month":return`${e.getFullYear()}年${e.getMonth()+1}月`;case"week":const o=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),l=o.getUTCDay()||7;o.setUTCDate(o.getUTCDate()+4-l);const t=new Date(Date.UTC(o.getUTCFullYear(),0,1)),i=Math.ceil(((o-t)/864e5+1)/7);return`${e.getFullYear()}年第${i}週`;case"day":return`${e.getMonth()+1}/${e.getDate()}`;case"weekday":return`${P[e.getDay()]}曜日`;case"hour":return`${e.getHours()}時`;default:return a}}function O(a,r,e){return!e||e==="none"?a:a.map(n=>({...n,[r]:U(n[r],e)}))}function w(a,r,e="sum"){if(a.length===0)return 0;switch(e){case"count":return a.length;case"sum":return a.reduce((t,i)=>t+(Number(i[r])||0),0);case"avg":const n=a.reduce((t,i)=>t+(Number(i[r])||0),0);return a.length>0?n/a.length:0;case"max":const o=a.map(t=>Number(t[r])||0);return Math.max(...o);case"min":const l=a.map(t=>Number(t[r])||0);return Math.min(...l);case"distinct":return new Set(a.map(t=>t[r])).size;default:return a.reduce((t,i)=>t+(Number(i[r])||0),0)}}const N={sum:"合計",count:"カウント",avg:"平均",max:"最大",min:"最小",distinct:"ユニーク数"};function M(a,r,e="none"){if(e==="none"||!e)return{sortedCategories:a,sortedValues:r};const n=a.map((o,l)=>({cat:o,val:r[l]}));switch(e){case"value_asc":n.sort((o,l)=>o.val-l.val);break;case"value_desc":n.sort((o,l)=>l.val-o.val);break;case"label_asc":n.sort((o,l)=>String(o.cat).localeCompare(String(l.cat),"ja"));break;case"label_desc":n.sort((o,l)=>String(l.cat).localeCompare(String(o.cat),"ja"));break}return{sortedCategories:n.map(o=>o.cat),sortedValues:n.map(o=>o.val)}}function F(a,r){const{xAxis:e,yAxis:n,title:o,horizontal:l=!1,aggregation:t="sum",groupBy:i="",stackMode:d="none",sortBy:p="none",enableZoom:x=!1}=a;let s=[...new Set(r.map(f=>f[e]))];const u=N[t]||t;if(i&&i!==""){const f=[...new Set(r.map(y=>y[i]))],g=o||`${n}の${u} (${e}別・${i}分類)`,b=f.map(y=>{const $=s.map(v=>{const D=r.filter(L=>L[e]===v&&L[i]===y);return w(D,n,t)});return{name:String(y),type:"bar",data:$,stack:d!=="none"?"total":void 0}});return d==="percent"&&s.forEach((y,$)=>{const v=b.reduce((D,L)=>D+(L.data[$]||0),0);v>0&&b.forEach(D=>{D.data[$]=D.data[$]/v*100})}),{title:{text:g,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:y=>{let $=y[0].name+"<br/>";return y.forEach(v=>{const D=typeof v.value=="number"?v.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):v.value,L=d==="percent"?"%":"";$+=`${v.marker}${v.seriesName}: ${D}${L}<br/>`}),$}},legend:{data:f.map(String),top:30},grid:{left:"3%",right:"4%",bottom:"3%",top:80,containLabel:!0},color:S,xAxis:l?{type:"value"}:{type:"category",data:s},yAxis:l?{type:"category",data:s}:{type:"value",minInterval:t==="count"||t==="distinct"?1:void 0,axisLabel:d==="percent"?{formatter:"{value}%"}:t==="count"||t==="distinct"?{formatter:y=>Math.floor(y)}:void 0},series:b}}let m=s.map(f=>{const g=r.filter(b=>b[e]===f);return w(g,n,t)});const C=M(s,m,p);s=C.sortedCategories,m=C.sortedValues;const c={title:{text:o||`${n}の${u} (${e}別)`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:f=>{const g=f[0],b=typeof g.value=="number"?g.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):g.value;return`${g.name}<br/>${u}: ${b}`}},grid:{left:"3%",right:"4%",bottom:x?"15%":"3%",containLabel:!0},color:S,toolbox:x?{feature:{dataZoom:{title:{zoom:"ズーム",back:"リセット"}},restore:{title:"リセット"}}}:void 0};x&&(c.dataZoom=[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:100},{type:"inside",xAxisIndex:[0],start:0,end:100}]);const h={type:"value",minInterval:t==="count"||t==="distinct"?1:void 0,axisLabel:t==="count"||t==="distinct"?{formatter:f=>Math.floor(f)}:void 0};return l?(c.xAxis={type:"value"},c.yAxis={type:"category",data:s},c.series=[{type:"bar",data:m}]):(c.xAxis={type:"category",data:s},c.yAxis=h,c.series=[{type:"bar",data:m}]),c}function T(a,r){const{xAxis:e,yAxis:n,title:o,smooth:l=!0,aggregation:t="sum",groupBy:i="",sortBy:d="none",enableZoom:p=!1}=a;let x=[...new Set(r.map(c=>c[e]))];const s=N[t]||t;if(i&&i!==""){const c=[...new Set(r.map(g=>g[i]))],h=o||`${n}の${s} (${e}別・${i}分類)`,f=c.map(g=>{const b=x.map(A=>{const y=r.filter($=>$[e]===A&&$[i]===g);return w(y,n,t)});return{name:String(g),type:"line",data:b,smooth:l,areaStyle:a.area?{}:void 0}});return{title:{text:h,left:"center"},tooltip:{trigger:"axis",formatter:g=>{let b=g[0].name+"<br/>";return g.forEach(A=>{const y=typeof A.value=="number"?A.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):A.value;b+=`${A.marker}${A.seriesName}: ${y}<br/>`}),b}},legend:{data:c.map(String),top:30},grid:{left:"3%",right:"4%",bottom:"3%",top:80,containLabel:!0},color:S,xAxis:{type:"category",data:x,boundaryGap:!1},yAxis:{type:"value",minInterval:t==="count"||t==="distinct"?1:void 0,axisLabel:t==="count"||t==="distinct"?{formatter:g=>Math.floor(g)}:void 0},series:f}}let u=x.map(c=>{const h=r.filter(f=>f[e]===c);return w(h,n,t)});const m=M(x,u,d);x=m.sortedCategories,u=m.sortedValues;const k={title:{text:o||`${n}の${s} (${e}別)`,left:"center"},tooltip:{trigger:"axis",formatter:c=>{const h=c[0],f=typeof h.value=="number"?h.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):h.value;return`${h.name}<br/>${s}: ${f}`}},grid:{left:"3%",right:"4%",bottom:p?"15%":"3%",containLabel:!0},color:S,toolbox:p?{feature:{dataZoom:{title:{zoom:"ズーム",back:"リセット"}},restore:{title:"リセット"}}}:void 0,xAxis:{type:"category",data:x,boundaryGap:!1},yAxis:{type:"value",minInterval:t==="count"||t==="distinct"?1:void 0,axisLabel:t==="count"||t==="distinct"?{formatter:c=>Math.floor(c)}:void 0},series:[{type:"line",data:u,smooth:l,areaStyle:a.area?{}:void 0}]};return p&&(k.dataZoom=[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:100},{type:"inside",xAxisIndex:[0],start:0,end:100}]),k}function j(a,r){const{category:e,value:n,title:o,donut:l=!1,aggregation:t="sum"}=a,d=[...new Set(r.map(s=>s[e]))].map(s=>{const u=r.filter(m=>m[e]===s);return{name:s,value:w(u,n,t)}}),p=N[t]||t;return{title:{text:o||`${n}の${p} (${e}別)`,left:"center"},tooltip:{trigger:"item",formatter:s=>{const u=typeof s.value=="number"?s.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):s.value;return`${s.name}<br/>${p}: ${u} (${s.percent}%)`}},legend:{orient:"vertical",left:"left"},color:S,series:[{type:"pie",radius:l?["40%","70%"]:"70%",data:d,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{formatter:"{b}: {d}%"}}]}}function B(a,r){const{xAxis:e,yAxis:n,title:o,category:l}=a;let t=[];return l?t=[...new Set(r.map(d=>d[l]))].map(d=>({name:d,type:"scatter",data:r.filter(p=>p[l]===d).map(p=>[Number(p[e])||0,Number(p[n])||0])})):t=[{type:"scatter",data:r.map(i=>[Number(i[e])||0,Number(i[n])||0])}],{title:{text:o||`${n} vs ${e}`,left:"center"},tooltip:{trigger:"item",formatter:i=>`${i.seriesName||""}<br/>${e}: ${i.data[0]}<br/>${n}: ${i.data[1]}`},legend:l?{data:[...new Set(r.map(i=>i[l]))],top:30}:void 0,grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},color:S,xAxis:{type:"value",name:e},yAxis:{type:"value",name:n},series:t}}function E(a,r){const{xAxis:e,barAxis:n,lineAxis:o,title:l,aggregation:t="sum"}=a,i=[...new Set(r.map(s=>s[e]))],d=i.map(s=>{const u=r.filter(m=>m[e]===s);return w(u,n,t)}),p=i.map(s=>{const u=r.filter(m=>m[e]===s);return w(u,o,t)}),x=N[t]||t;return{title:{text:l||`${n} & ${o}の${x} (${e}別)`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:s=>{let u=s[0].name+"<br/>";return s.forEach(m=>{const C=typeof m.value=="number"?m.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):m.value;u+=`${m.seriesName}: ${C}<br/>`}),u}},legend:{data:[n,o],top:30},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},color:S,xAxis:{type:"category",data:i},yAxis:[{type:"value",name:n,position:"left"},{type:"value",name:o,position:"right"}],series:[{name:n,type:"bar",data:d},{name:o,type:"line",yAxisIndex:1,data:p,smooth:!0}]}}function J(a,r,e){switch(a){case"bar":return F(r,e);case"line":return T(r,e);case"pie":return j(r,e);case"scatter":return B(r,e);case"combo":return E(r,e);case"area":return T({...r,area:!0},e);default:return F(r,e)}}export{O as a,I as d,J as g};
