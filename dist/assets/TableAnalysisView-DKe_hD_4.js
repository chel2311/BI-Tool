import{i as A,j as b,c as o,a as s,d as V,l as d,t as v,b as T,w as z,r as H,F as M,q as S,s as c,v as B,A as w,m as L,o as n,B as O,D as $}from"./vendor-vue-KVDUZo9Z.js";import{u as J}from"./dataStore-B12QgO0T.js";const G={class:"space-y-4"},K={class:"bg-white rounded-lg shadow-md p-4"},Q={class:"flex items-center justify-between"},W={class:"text-sm text-gray-500"},X={key:0,class:"text-primary-600"},Y=["disabled"],Z={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center"},ee={class:"text-yellow-700"},te={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},se={class:"bg-white rounded-lg shadow-md p-4 space-y-4"},le={key:0,class:"text-sm text-gray-400 py-2 text-center border border-dashed rounded"},oe={key:1,class:"space-y-2"},ne={class:"flex items-center gap-2 mb-1"},ae=["onUpdate:modelValue"],ue=["value"],re=["onClick"],ie={class:"flex items-center gap-2"},de=["onUpdate:modelValue"],ve=["onUpdate:modelValue"],me={key:2,class:"mt-2 text-xs text-gray-500"},pe={class:"space-y-3"},ce=["value"],xe=["value"],ye={class:"space-y-1"},he={class:"flex items-center"},ge={class:"flex items-center"},be={class:"flex items-center"},fe={class:"flex items-center"},_e={class:"flex items-center"},we={class:"flex items-center"},ke={class:"lg:col-span-2 bg-white rounded-lg shadow-md p-4"},Ce={class:"font-semibold text-gray-800 mb-3"},Ve={key:0,class:"text-sm font-normal text-gray-500"},Me={key:0,class:"text-center text-gray-400 py-8"},Se={key:1,class:"text-center text-gray-400 py-8"},Be={key:2,class:"overflow-x-auto"},Ue={class:"w-full text-sm"},Ne={class:"bg-gray-50 border-b"},Fe={class:"px-3 py-2 text-left font-medium text-gray-700"},je={key:0,class:"px-3 py-2 text-right font-medium text-gray-700"},Ae={key:1,class:"px-3 py-2 text-right font-medium text-gray-700"},Le={key:2,class:"px-3 py-2 text-right font-medium text-gray-700"},De={key:3,class:"px-3 py-2 text-right font-medium text-gray-700"},Pe={key:4,class:"px-3 py-2 text-right font-medium text-gray-700"},Re={key:5,class:"px-3 py-2 text-right font-medium text-gray-700"},Ee={class:"px-3 py-2 text-gray-800"},qe={key:0,class:"px-3 py-2 text-right text-gray-600"},Ie={key:1,class:"px-3 py-2 text-right text-gray-600"},Te={key:2,class:"px-3 py-2 text-right text-gray-600"},ze={key:3,class:"px-3 py-2 text-right text-gray-600"},He={key:4,class:"px-3 py-2 text-right text-gray-600"},Oe={key:5,class:"px-3 py-2 text-right"},$e={class:"flex items-center justify-end"},Je={class:"w-16 bg-gray-200 rounded-full h-2 mr-2"},Ge={class:"text-gray-600 w-12 text-right"},Ke={key:0,class:"bg-gray-100 font-medium"},Qe={key:0,class:"px-3 py-2 text-right text-gray-800"},We={key:1,class:"px-3 py-2 text-right text-gray-800"},Xe={key:2,class:"px-3 py-2 text-right text-gray-800"},Ye={key:3,class:"px-3 py-2 text-right text-gray-800"},Ze={key:4,class:"px-3 py-2 text-right text-gray-800"},et={key:5,class:"px-3 py-2 text-right text-gray-800"},ot={__name:"TableAnalysisView",setup(tt){const D=J(),h=A([]);function P(){h.value.push({column:"",operator:"eq",value:""})}function R(a){h.value.splice(a,1)}const t=A({groupBy:"",valueColumn:"",showCount:!0,showSum:!0,showAvg:!0,showMin:!1,showMax:!1,showPercent:!0,sortBy:"count_desc"}),g=b(()=>D.activeDataset),F=b(()=>{var a;return((a=g.value)==null?void 0:a.columns)||[]}),k=b(()=>{var a;return((a=g.value)==null?void 0:a.data)||[]}),f=b(()=>k.value.length?h.value.length?k.value.filter(a=>h.value.every(e=>{if(!e.column)return!0;const u=a[e.column],l=e.value;switch(e.operator){case"eq":return String(u)===String(l);case"ne":return String(u)!==String(l);case"contains":return String(u).toLowerCase().includes(String(l).toLowerCase());case"not_contains":return!String(u).toLowerCase().includes(String(l).toLowerCase());case"gt":return Number(u)>Number(l);case"gte":return Number(u)>=Number(l);case"lt":return Number(u)<Number(l);case"lte":return Number(u)<=Number(l);case"empty":return u==null||u==="";case"not_empty":return u!=null&&u!=="";default:return!0}})):k.value:[]),E=b(()=>{var e,u;if(!((u=(e=g.value)==null?void 0:e.data)!=null&&u.length))return[];const a=g.value.data[0];return F.value.filter(l=>{const m=a[l];return typeof m=="number"||!isNaN(parseFloat(m))})}),x=b(()=>{if(!t.value.groupBy||!f.value.length)return[];const a=new Map;f.value.forEach(r=>{const i=String(r[t.value.groupBy]??"(空白)");a.has(i)||a.set(i,[]),a.get(i).push(r)});const e=f.value.length,u=t.value.valueColumn,l=Array.from(a.entries()).map(([r,i])=>{const p=i.length;let j=0,U=1/0,N=-1/0;return u&&i.forEach(I=>{const C=parseFloat(I[u])||0;j+=C,C<U&&(U=C),C>N&&(N=C)}),{label:r,count:p,sum:u?j:0,avg:u&&p>0?j/p:0,min:u&&U!==1/0?U:0,max:u&&N!==-1/0?N:0,percent:e>0?p/e*100:0}}),m={label_asc:(r,i)=>r.label.localeCompare(i.label),label_desc:(r,i)=>i.label.localeCompare(r.label),count_desc:(r,i)=>i.count-r.count,count_asc:(r,i)=>r.count-i.count,sum_desc:(r,i)=>i.sum-r.sum,sum_asc:(r,i)=>r.sum-i.sum};return l.sort(m[t.value.sortBy]||m.count_desc)}),_=b(()=>{if(!x.value.length)return null;const a=x.value.reduce((l,m)=>l+m.count,0),e=x.value.reduce((l,m)=>l+m.sum,0),u=f.value.map(l=>parseFloat(l[t.value.valueColumn])||0);return{count:a,sum:e,avg:a>0?e/a:0,min:u.length?Math.min(...u):0,max:u.length?Math.max(...u):0}});function y(a,e=0){return a==null?"-":Number(a).toLocaleString("ja-JP",{minimumFractionDigits:e,maximumFractionDigits:e})}function q(){if(!x.value.length)return;const a=[t.value.groupBy];t.value.showCount&&a.push("カウント"),t.value.showSum&&t.value.valueColumn&&a.push("合計"),t.value.showAvg&&t.value.valueColumn&&a.push("平均"),t.value.showMin&&t.value.valueColumn&&a.push("最小"),t.value.showMax&&t.value.valueColumn&&a.push("最大"),t.value.showPercent&&a.push("割合(%)");const e=x.value.map(i=>{const p=[i.label];return t.value.showCount&&p.push(i.count),t.value.showSum&&t.value.valueColumn&&p.push(i.sum),t.value.showAvg&&t.value.valueColumn&&p.push(i.avg.toFixed(2)),t.value.showMin&&t.value.valueColumn&&p.push(i.min),t.value.showMax&&t.value.valueColumn&&p.push(i.max),t.value.showPercent&&p.push(i.percent.toFixed(1)),p.join(",")}),u=[a.join(","),...e].join(`
`),l=new Blob(["\uFEFF"+u],{type:"text/csv;charset=utf-8"}),m=URL.createObjectURL(l),r=document.createElement("a");r.href=m,r.download=`analysis_${Date.now()}.csv`,r.click(),URL.revokeObjectURL(m)}return(a,e)=>{const u=H("router-link");return n(),o("div",G,[s("div",K,[s("div",Q,[s("div",null,[e[10]||(e[10]=s("h2",{class:"text-xl font-semibold text-gray-800"},"表形式分析",-1)),s("p",W,[e[9]||(e[9]=V(" データを集計・分析 ",-1)),g.value?(n(),o("span",X," （"+v(g.value.name)+" - "+v(f.value.length)+"/"+v(k.value.length)+"行） ",1)):d("",!0)])]),s("button",{onClick:q,class:"btn-primary text-sm",disabled:!x.value.length}," CSV出力 ",8,Y)])]),g.value?(n(),o("div",te,[s("div",se,[s("div",null,[s("div",{class:"flex items-center justify-between mb-2"},[e[14]||(e[14]=s("h3",{class:"font-semibold text-gray-800"},"フィルター条件",-1)),s("button",{onClick:P,class:"text-xs text-primary-600 hover:text-primary-800 flex items-center"},[...e[13]||(e[13]=[s("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),V(" 追加 ",-1)])])]),h.value.length===0?(n(),o("div",le," フィルターなし（全データ対象） ")):(n(),o("div",oe,[(n(!0),o(M,null,S(h.value,(l,m)=>(n(),o("div",{key:m,class:"bg-gray-50 rounded p-2 text-sm"},[s("div",ne,[c(s("select",{"onUpdate:modelValue":r=>l.column=r,class:"select-box text-xs flex-1"},[e[15]||(e[15]=s("option",{value:""},"カラム選択",-1)),(n(!0),o(M,null,S(F.value,r=>(n(),o("option",{key:r,value:r},v(r),9,ue))),128))],8,ae),[[B,l.column]]),s("button",{onClick:r=>R(m),class:"text-red-400 hover:text-red-600"},[...e[16]||(e[16]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,re)]),s("div",ie,[c(s("select",{"onUpdate:modelValue":r=>l.operator=r,class:"select-box text-xs w-24"},[...e[17]||(e[17]=[L('<option value="eq">=</option><option value="ne">≠</option><option value="contains">含む</option><option value="not_contains">含まない</option><option value="gt">&gt;</option><option value="gte">≥</option><option value="lt">&lt;</option><option value="lte">≤</option><option value="empty">空</option><option value="not_empty">空でない</option>',10)])],8,de),[[B,l.operator]]),["empty","not_empty"].includes(l.operator)?d("",!0):c((n(),o("input",{key:0,"onUpdate:modelValue":r=>l.value=r,type:"text",class:"input-field text-xs flex-1",placeholder:"値"},null,8,ve)),[[O,l.value]])])]))),128))])),h.value.length>0?(n(),o("div",me,v(f.value.length)+" / "+v(k.value.length)+" 件がマッチ ",1)):d("",!0)]),e[32]||(e[32]=s("hr",{class:"border-gray-200"},null,-1)),s("div",null,[e[31]||(e[31]=s("h3",{class:"font-semibold text-gray-800 mb-3"},"集計設定",-1)),s("div",pe,[s("div",null,[e[19]||(e[19]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"グループ化",-1)),c(s("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.groupBy=l),class:"select-box"},[e[18]||(e[18]=s("option",{value:""},"選択してください",-1)),(n(!0),o(M,null,S(F.value,l=>(n(),o("option",{key:l,value:l},v(l),9,ce))),128))],512),[[B,t.value.groupBy]])]),s("div",null,[e[21]||(e[21]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"集計対象カラム",-1)),c(s("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.valueColumn=l),class:"select-box"},[e[20]||(e[20]=s("option",{value:""},"選択してください",-1)),(n(!0),o(M,null,S(E.value,l=>(n(),o("option",{key:l,value:l},v(l),9,xe))),128))],512),[[B,t.value.valueColumn]])]),s("div",null,[e[28]||(e[28]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"表示する集計",-1)),s("div",ye,[s("label",he,[c(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=l=>t.value.showCount=l),class:"rounded text-primary-600 mr-2"},null,512),[[w,t.value.showCount]]),e[22]||(e[22]=s("span",{class:"text-sm"},"カウント",-1))]),s("label",ge,[c(s("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=l=>t.value.showSum=l),class:"rounded text-primary-600 mr-2"},null,512),[[w,t.value.showSum]]),e[23]||(e[23]=s("span",{class:"text-sm"},"合計",-1))]),s("label",be,[c(s("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>t.value.showAvg=l),class:"rounded text-primary-600 mr-2"},null,512),[[w,t.value.showAvg]]),e[24]||(e[24]=s("span",{class:"text-sm"},"平均",-1))]),s("label",fe,[c(s("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>t.value.showMin=l),class:"rounded text-primary-600 mr-2"},null,512),[[w,t.value.showMin]]),e[25]||(e[25]=s("span",{class:"text-sm"},"最小",-1))]),s("label",_e,[c(s("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>t.value.showMax=l),class:"rounded text-primary-600 mr-2"},null,512),[[w,t.value.showMax]]),e[26]||(e[26]=s("span",{class:"text-sm"},"最大",-1))]),s("label",we,[c(s("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>t.value.showPercent=l),class:"rounded text-primary-600 mr-2"},null,512),[[w,t.value.showPercent]]),e[27]||(e[27]=s("span",{class:"text-sm"},"割合（%）",-1))])])]),s("div",null,[e[30]||(e[30]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"並び順",-1)),c(s("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.sortBy=l),class:"select-box"},[...e[29]||(e[29]=[L('<option value="label_asc">ラベル（昇順）</option><option value="label_desc">ラベル（降順）</option><option value="count_desc">カウント（多い順）</option><option value="count_asc">カウント（少ない順）</option><option value="sum_desc">合計（大きい順）</option><option value="sum_asc">合計（小さい順）</option>',6)])],512),[[B,t.value.sortBy]])])])])]),s("div",ke,[s("h3",Ce,[e[33]||(e[33]=V(" 分析結果 ",-1)),x.value.length?(n(),o("span",Ve," （"+v(x.value.length)+" グループ） ",1)):d("",!0)]),t.value.groupBy?x.value.length===0?(n(),o("div",Se," データがありません ")):(n(),o("div",Be,[s("table",Ue,[s("thead",null,[s("tr",Ne,[s("th",Fe,v(t.value.groupBy),1),t.value.showCount?(n(),o("th",je,"カウント")):d("",!0),t.value.showSum&&t.value.valueColumn?(n(),o("th",Ae,"合計")):d("",!0),t.value.showAvg&&t.value.valueColumn?(n(),o("th",Le,"平均")):d("",!0),t.value.showMin&&t.value.valueColumn?(n(),o("th",De,"最小")):d("",!0),t.value.showMax&&t.value.valueColumn?(n(),o("th",Pe,"最大")):d("",!0),t.value.showPercent?(n(),o("th",Re,"割合")):d("",!0)])]),s("tbody",null,[(n(!0),o(M,null,S(x.value,(l,m)=>(n(),o("tr",{key:m,class:"border-b hover:bg-gray-50 transition-colors"},[s("td",Ee,v(l.label),1),t.value.showCount?(n(),o("td",qe,v(y(l.count)),1)):d("",!0),t.value.showSum&&t.value.valueColumn?(n(),o("td",Ie,v(y(l.sum)),1)):d("",!0),t.value.showAvg&&t.value.valueColumn?(n(),o("td",Te,v(y(l.avg,2)),1)):d("",!0),t.value.showMin&&t.value.valueColumn?(n(),o("td",ze,v(y(l.min)),1)):d("",!0),t.value.showMax&&t.value.valueColumn?(n(),o("td",He,v(y(l.max)),1)):d("",!0),t.value.showPercent?(n(),o("td",Oe,[s("div",$e,[s("div",Je,[s("div",{class:"bg-primary-500 h-2 rounded-full",style:$({width:l.percent+"%"})},null,4)]),s("span",Ge,v(l.percent.toFixed(1))+"%",1)])])):d("",!0)]))),128))]),_.value?(n(),o("tfoot",Ke,[s("tr",null,[e[35]||(e[35]=s("td",{class:"px-3 py-2 text-gray-800"},"合計",-1)),t.value.showCount?(n(),o("td",Qe,v(y(_.value.count)),1)):d("",!0),t.value.showSum&&t.value.valueColumn?(n(),o("td",We,v(y(_.value.sum)),1)):d("",!0),t.value.showAvg&&t.value.valueColumn?(n(),o("td",Xe,v(y(_.value.avg,2)),1)):d("",!0),t.value.showMin&&t.value.valueColumn?(n(),o("td",Ye,v(y(_.value.min)),1)):d("",!0),t.value.showMax&&t.value.valueColumn?(n(),o("td",Ze,v(y(_.value.max)),1)):d("",!0),t.value.showPercent?(n(),o("td",et,"100%")):d("",!0)])])):d("",!0)])])):(n(),o("div",Me,[...e[34]||(e[34]=[s("svg",{class:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),s("p",null,"グループ化するカラムを選択してください",-1)])]))])])):(n(),o("div",Z,[s("p",ee,[e[12]||(e[12]=V(" まずデータをアップロードしてください。 ",-1)),T(u,{to:"/",class:"text-primary-500 hover:underline"},{default:z(()=>[...e[11]||(e[11]=[V("ホームに戻る",-1)])]),_:1})])]))])}}};export{ot as default};
