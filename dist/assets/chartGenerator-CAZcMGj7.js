const L=["#005BAB","#FF961C","#00A86B","#E63946","#457B9D","#2A9D8F","#E9C46A","#F4A261","#264653","#A8DADC"],I={none:"そのまま",year:"年",quarter:"四半期",month:"月",week:"週",day:"日",weekday:"曜日",hour:"時"},P=["日","月","火","水","木","金","土"];function U(a,r){if(!a||r==="none")return a;let e;if(a instanceof Date?e=a:typeof a=="number"?a>25569&&a<5e4?e=new Date((a-25569)*86400*1e3):e=new Date(a):e=new Date(a),isNaN(e.getTime()))return a;switch(r){case"year":return`${e.getFullYear()}年`;case"quarter":const n=Math.floor(e.getMonth()/3)+1;return`${e.getFullYear()}年Q${n}`;case"month":return`${e.getFullYear()}年${e.getMonth()+1}月`;case"week":const o=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),s=o.getUTCDay()||7;o.setUTCDate(o.getUTCDate()+4-s);const t=new Date(Date.UTC(o.getUTCFullYear(),0,1)),i=Math.ceil(((o-t)/864e5+1)/7);return`${e.getFullYear()}年第${i}週`;case"day":return`${e.getMonth()+1}/${e.getDate()}`;case"weekday":return`${P[e.getDay()]}曜日`;case"hour":return`${e.getHours()}時`;default:return a}}function O(a,r,e){return!e||e==="none"?a:a.map(n=>({...n,[r]:U(n[r],e)}))}function C(a,r,e="sum"){if(a.length===0)return 0;switch(e){case"count":return a.length;case"sum":return a.reduce((t,i)=>t+(Number(i[r])||0),0);case"avg":const n=a.reduce((t,i)=>t+(Number(i[r])||0),0);return a.length>0?n/a.length:0;case"max":const o=a.map(t=>Number(t[r])||0);return Math.max(...o);case"min":const s=a.map(t=>Number(t[r])||0);return Math.min(...s);case"distinct":return new Set(a.map(t=>t[r])).size;default:return a.reduce((t,i)=>t+(Number(i[r])||0),0)}}const k={sum:"合計",count:"カウント",avg:"平均",max:"最大",min:"最小",distinct:"ユニーク数"};function M(a,r,e="none"){if(e==="none"||!e)return{sortedCategories:a,sortedValues:r};const n=a.map((o,s)=>({cat:o,val:r[s]}));switch(e){case"value_asc":n.sort((o,s)=>o.val-s.val);break;case"value_desc":n.sort((o,s)=>s.val-o.val);break;case"label_asc":n.sort((o,s)=>String(o.cat).localeCompare(String(s.cat),"ja"));break;case"label_desc":n.sort((o,s)=>String(s.cat).localeCompare(String(o.cat),"ja"));break}return{sortedCategories:n.map(o=>o.cat),sortedValues:n.map(o=>o.val)}}function F(a,r){const{xAxis:e,yAxis:n,title:o,horizontal:s=!1,aggregation:t="sum",groupBy:i="",stackMode:g="none",sortBy:d="none",enableZoom:y=!1}=a;let l=[...new Set(r.map(f=>f[e]))];const x=k[t]||t;if(i&&i!==""){const f=[...new Set(r.map(p=>p[i]))],m=o||`${n}の${x} (${e}別・${i}分類)`,$=f.map(p=>{const h=l.map(D=>{const w=r.filter(N=>N[e]===D&&N[i]===p);return C(w,n,t)});return{name:String(p),type:"bar",data:h,stack:g!=="none"?"total":void 0}});return g==="percent"&&l.forEach((p,h)=>{const D=$.reduce((w,N)=>w+(N.data[h]||0),0);D>0&&$.forEach(w=>{w.data[h]=w.data[h]/D*100})}),{title:{text:m,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:p=>{let h=p[0].name+"<br/>";return p.forEach(D=>{const w=typeof D.value=="number"?D.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):D.value,N=g==="percent"?"%":"";h+=`${D.marker}${D.seriesName}: ${w}${N}<br/>`}),h}},legend:{data:f.map(String),top:30},grid:{left:"3%",right:"4%",bottom:"3%",top:80,containLabel:!0},color:L,xAxis:s?{type:"value"}:{type:"category",data:l},yAxis:s?{type:"category",data:l}:{type:"value",minInterval:t==="count"||t==="distinct"?1:void 0,axisLabel:g==="percent"?{formatter:"{value}%"}:t==="count"||t==="distinct"?{formatter:p=>Math.floor(p)}:void 0},series:$}}let u=l.map(f=>{const m=r.filter($=>$[e]===f);return C(m,n,t)});const v=M(l,u,d);l=v.sortedCategories,u=v.sortedValues;const c={title:{text:o||`${n}の${x} (${e}別)`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:f=>{const m=f[0],$=typeof m.value=="number"?m.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):m.value;return`${m.name}<br/>${x}: ${$}`}},grid:{left:"3%",right:"4%",bottom:y?"15%":"3%",containLabel:!0},color:L,toolbox:y?{feature:{dataZoom:{title:{zoom:"ズーム",back:"リセット"}},restore:{title:"リセット"}}}:void 0};y&&(c.dataZoom=[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:100},{type:"inside",xAxisIndex:[0],start:0,end:100}]);const A={type:"value",minInterval:t==="count"||t==="distinct"?1:void 0,axisLabel:t==="count"||t==="distinct"?{formatter:f=>Math.floor(f)}:void 0};return s?(c.xAxis={type:"value"},c.yAxis={type:"category",data:l},c.series=[{type:"bar",data:u}]):(c.xAxis={type:"category",data:l},c.yAxis=A,c.series=[{type:"bar",data:u}]),c}function T(a,r){const{xAxis:e,yAxis:n,title:o,smooth:s=!0,aggregation:t="sum",groupBy:i="",sortBy:g="none",enableZoom:d=!1}=a;let y=[...new Set(r.map(c=>c[e]))];const l=k[t]||t;if(i&&i!==""){const c=[...new Set(r.map(m=>m[i]))],A=o||`${n}の${l} (${e}別・${i}分類)`,f=c.map(m=>{const $=y.map(S=>{const p=r.filter(h=>h[e]===S&&h[i]===m);return C(p,n,t)});return{name:String(m),type:"line",data:$,smooth:s,areaStyle:a.area?{}:void 0}});return{title:{text:A,left:"center"},tooltip:{trigger:"axis",formatter:m=>{let $=m[0].name+"<br/>";return m.forEach(S=>{const p=typeof S.value=="number"?S.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):S.value;$+=`${S.marker}${S.seriesName}: ${p}<br/>`}),$}},legend:{data:c.map(String),top:30},grid:{left:"3%",right:"4%",bottom:"3%",top:80,containLabel:!0},color:L,xAxis:{type:"category",data:y,boundaryGap:!1},yAxis:{type:"value",minInterval:t==="count"||t==="distinct"?1:void 0,axisLabel:t==="count"||t==="distinct"?{formatter:m=>Math.floor(m)}:void 0},series:f}}let x=y.map(c=>{const A=r.filter(f=>f[e]===c);return C(A,n,t)});const u=M(y,x,g);y=u.sortedCategories,x=u.sortedValues;const b={title:{text:o||`${n}の${l} (${e}別)`,left:"center"},tooltip:{trigger:"axis",formatter:c=>{const A=c[0],f=typeof A.value=="number"?A.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):A.value;return`${A.name}<br/>${l}: ${f}`}},grid:{left:"3%",right:"4%",bottom:d?"15%":"3%",containLabel:!0},color:L,toolbox:d?{feature:{dataZoom:{title:{zoom:"ズーム",back:"リセット"}},restore:{title:"リセット"}}}:void 0,xAxis:{type:"category",data:y,boundaryGap:!1},yAxis:{type:"value",minInterval:t==="count"||t==="distinct"?1:void 0,axisLabel:t==="count"||t==="distinct"?{formatter:c=>Math.floor(c)}:void 0},series:[{type:"line",data:x,smooth:s,areaStyle:a.area?{}:void 0}]};return d&&(b.dataZoom=[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:100},{type:"inside",xAxisIndex:[0],start:0,end:100}]),b}function j(a,r){const{category:e,value:n,title:o,donut:s=!1,aggregation:t="sum"}=a,g=[...new Set(r.map(l=>l[e]))].map(l=>{const x=r.filter(u=>u[e]===l);return{name:l,value:C(x,n,t)}}),d=k[t]||t;return{title:{text:o||`${n}の${d} (${e}別)`,left:"center"},tooltip:{trigger:"item",formatter:l=>{const x=typeof l.value=="number"?l.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):l.value;return`${l.name}<br/>${d}: ${x} (${l.percent}%)`}},legend:{orient:"vertical",left:"left"},color:L,series:[{type:"pie",radius:s?["40%","70%"]:"70%",data:g,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{formatter:"{b}: {d}%"}}]}}function B(a,r){const{xAxis:e,yAxis:n,title:o,category:s}=a;let t=[];return s?t=[...new Set(r.map(g=>g[s]))].map(g=>({name:g,type:"scatter",data:r.filter(d=>d[s]===g).map(d=>[Number(d[e])||0,Number(d[n])||0])})):t=[{type:"scatter",data:r.map(i=>[Number(i[e])||0,Number(i[n])||0])}],{title:{text:o||`${n} vs ${e}`,left:"center"},tooltip:{trigger:"item",formatter:i=>`${i.seriesName||""}<br/>${e}: ${i.data[0]}<br/>${n}: ${i.data[1]}`},legend:s?{data:[...new Set(r.map(i=>i[s]))],top:30}:void 0,grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},color:L,xAxis:{type:"value",name:e},yAxis:{type:"value",name:n},series:t}}function E(a,r){const{xAxis:e,barAxis:n,lineAxis:o,title:s,aggregation:t="sum",lineAggregation:i="sum"}=a,g=[...new Set(r.map(u=>u[e]))],d=g.map(u=>{const v=r.filter(b=>b[e]===u);return C(v,n,t)}),y=g.map(u=>{const v=r.filter(b=>b[e]===u);return C(v,o,i)}),l=k[t]||t,x=k[i]||i;return{title:{text:s||`${n}(${l}) & ${o}(${x}) (${e}別)`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:u=>{let v=u[0].name+"<br/>";return u.forEach(b=>{const c=typeof b.value=="number"?b.value.toLocaleString("ja-JP",{maximumFractionDigits:2}):b.value;v+=`${b.seriesName}: ${c}<br/>`}),v}},legend:{data:[n,o],top:30},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},color:L,xAxis:{type:"category",data:g},yAxis:[{type:"value",name:n,position:"left"},{type:"value",name:o,position:"right"}],series:[{name:n,type:"bar",data:d},{name:o,type:"line",yAxisIndex:1,data:y,smooth:!0}]}}function J(a,r,e){switch(a){case"bar":return F(r,e);case"line":return T(r,e);case"pie":return j(r,e);case"scatter":return B(r,e);case"combo":return E(r,e);case"area":return T({...r,area:!0},e);default:return F(r,e)}}export{O as a,I as d,J as g};
