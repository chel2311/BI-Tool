import{i as j,j as z,k as K,c as y,a as s,l as L,m as O,n as J,p as M,t as _,F as R,q as V,s as W,d as B,v as X,u as Y,o as b}from"./vendor-vue-KVDUZo9Z.js";import{u as Z}from"./dataStore-B12QgO0T.js";import{r as q,u as G}from"./vendor-xlsx-B9CstNKb.js";function F(o){const u=o.filter(n=>n!=null&&n!=="");if(u.length===0)return"string";const e=u.slice(0,100);if(e.filter(n=>typeof n=="boolean"||n==="true"||n==="false"||n==="TRUE"||n==="FALSE").length/e.length>.9)return"boolean";if(e.filter(n=>{if(typeof n=="number")return!isNaN(n);const r=parseFloat(String(n).replace(/,/g,""));return!isNaN(r)}).length/e.length>.9)return"number";const a=[/^\d{4}[-\/]\d{1,2}[-\/]\d{1,2}$/,/^\d{1,2}[-\/]\d{1,2}[-\/]\d{4}$/,/^\d{4}年\d{1,2}月\d{1,2}日$/];return e.filter(n=>{if(n instanceof Date)return!isNaN(n);const r=String(n);return a.some(m=>m.test(r))||!isNaN(Date.parse(r))}).length/e.length>.9?"date":"string"}function T(o,u){return o.map(e=>{const l={};for(const[f,a]of Object.entries(e)){const d=u[f];if(d==="number"){const n=typeof a=="number"?a:parseFloat(String(a).replace(/,/g,""));l[f]=isNaN(n)?null:n}else if(d==="date"){const n=a instanceof Date?a:new Date(a);l[f]=isNaN(n)?null:n}else d==="boolean"?l[f]=a===!0||a==="true"||a==="TRUE":l[f]=String(a??"")}return l})}function I(o,u=20){if(!o||o.length===0)return 0;const e=Math.min(o.length-1,u),l=Math.max(...o.slice(0,10).map(r=>(r==null?void 0:r.length)||0));if(l===0)return 0;function f(r){var i;const m=[];for(let v=0;v<l;v++){let g=0,C=0,N=0,E=0;for(let x=r;x<Math.min(o.length,r+20);x++){const w=(i=o[x])==null?void 0:i[v];if(E++,w==null||w===""){N++;continue}if(typeof w=="number")g++;else{const c=String(w).trim(),k=parseFloat(c.replace(/,/g,""));!isNaN(k)&&c!==""?g++:C++}}m.push({numeric:g,string:C,empty:N,total:E,isNumericColumn:g>C&&g>0})}return m}function a(r){const m=o[r];if(!m||m.length===0)return-1;let i=0;const v=f(r+1);let g=0,C=0,N=0,E=0;for(let x=0;x<Math.min(m.length,l);x++){const w=m[x];if(w==null||w==="")continue;g++;const c=typeof w=="number"||!isNaN(parseFloat(String(w).replace(/,/g,"")))&&String(w).trim()!=="";c?N++:C++;const k=v[x];k&&k.isNumericColumn&&!c&&E++}if(g>=l*.3&&(i+=20),g>0&&N/g>.9&&(i-=50),g>0&&(i+=C/g*30),i+=E*10,r+1<o.length){const x=o[r+1];((x==null?void 0:x.filter(c=>c!=null&&c!=="").length)||0)>0&&(i+=10)}return i}let d=0,n=-1/0;for(let r=0;r<e;r++){const m=o[r];if(!m||m.filter(g=>g!=null&&g!=="").length===0)continue;const v=a(r);v>n&&(n=v,d=r)}return d}function ee(o){const u=o.split(/\r?\n/).filter(d=>d.trim());if(u.length===0)throw new Error("空のファイルです");const e=P(u[0]),l=u.slice(1).map(d=>{const n=P(d),r={};return e.forEach((m,i)=>{r[m]=n[i]??""}),r}),f={};e.forEach(d=>{const n=l.map(r=>r[d]);f[d]=F(n)});const a=T(l,f);return{columns:e,data:a,types:f}}function P(o){const u=[];let e="",l=!1;for(let f=0;f<o.length;f++){const a=o[f];a==='"'?l&&o[f+1]==='"'?(e+='"',f++):l=!l:a===","&&!l?(u.push(e.trim()),e=""):e+=a}return u.push(e.trim()),u}async function te(o){const u=await o.text(),e=ee(u);return{...e,name:o.name,rowCount:e.data.length}}async function se(o){const u=await o.arrayBuffer(),e=q(u,{type:"array",cellDates:!0});return{sheets:e.SheetNames.map(f=>{var m;const a=e.Sheets[f],d=G.sheet_to_json(a,{header:1,defval:""}),n=I(d),r=d.slice(0,Math.min(10,d.length));return{name:f,rowCount:d.length,colCount:((m=d[0])==null?void 0:m.length)||0,headerRow:n,preview:r}}),fileName:o.name}}async function ne(o,u={}){const{sheetName:e=null,headerRow:l=null}=u,f=await o.arrayBuffer(),a=q(f,{type:"array",cellDates:!0}),d=a.SheetNames,n=e||d[0],r=a.Sheets[n];if(!r)throw new Error(`シート "${n}" が見つかりません`);const m=G.sheet_to_json(r,{header:1,defval:""});if(m.length===0)throw new Error("空のシートです");const i=l!==null?l:I(m),g=(m[i]||[]).map((c,k)=>c!=null&&c!==""?String(c).trim():`Column${k+1}`),C={},N=g.map(c=>C[c]===void 0?(C[c]=0,c):(C[c]++,`${c}_${C[c]}`)),E=m.slice(i+1).filter(c=>c.some(k=>k!=null&&k!=="")).map(c=>{const k={};return N.forEach((D,h)=>{k[D]=c[h]??""}),k}),x={};N.forEach(c=>{const k=E.map(D=>D[c]);x[c]=F(k)});const w=T(E,x);return{columns:N,data:w,types:x,sheets:d,currentSheet:n,headerRow:i,name:o.name,rowCount:w.length}}async function oe(o){const u=await o.text(),e=JSON.parse(u),l=Array.isArray(e)?e:[e];if(l.length===0)throw new Error("空のJSONです");const f=Object.keys(l[0]),a={};f.forEach(n=>{const r=l.map(m=>m[n]);a[n]=F(r)});const d=T(l,a);return{columns:f,data:d,types:a,name:o.name,rowCount:d.length}}async function U(o,u={}){const e=o.name.split(".").pop().toLowerCase();switch(e){case"csv":return te(o);case"xlsx":case"xls":return ne(o,u);case"json":return oe(o);default:throw new Error(`対応していないファイル形式です: ${e}`)}}function re(o){const u=o.name.split(".").pop().toLowerCase();return u==="xlsx"||u==="xls"}const le={class:"max-w-4xl mx-auto"},ae={key:0,class:"space-y-4"},ie={key:1,class:"flex flex-col items-center space-y-4"},ce={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ue={class:"bg-white rounded-lg shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-hidden"},de={class:"p-6 border-b"},me={class:"text-sm text-gray-500 mt-1"},fe={class:"p-6 overflow-y-auto max-h-[60vh]"},pe={class:"mb-6"},he={class:"grid grid-cols-2 md:grid-cols-3 gap-2"},ge=["onClick"],ve={class:"font-medium truncate"},xe={class:"text-xs text-gray-500"},ye={key:0,class:"mb-6"},be={class:"block text-sm font-medium text-gray-700 mb-2"},we={class:"text-xs text-gray-500 ml-2"},ke=["value"],Ce={key:1,class:"mb-4"},_e={class:"overflow-x-auto border rounded-lg"},Ne={class:"min-w-full text-xs"},Ee={class:"px-2 py-1 text-gray-400 border-r bg-gray-100"},Se={class:"p-6 border-t bg-gray-50 flex justify-end space-x-3"},De=["disabled"],je={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4 mb-8"},Le={class:"flex items-center"},Me={class:"text-red-700"},Re={key:2,class:"bg-white rounded-lg shadow-md p-6"},Ve={class:"space-y-3"},$e={class:"flex items-center space-x-3"},ze={class:"font-medium text-gray-800"},Be={class:"text-sm text-gray-500"},Fe={key:0,class:"ml-2 text-xs bg-gray-100 px-1 rounded"},Te={class:"flex items-center space-x-2"},Ae=["onClick"],He=["onClick"],Ue={__name:"HomeView",setup(o){const u=Y(),e=Z(),l=j(!1),f=z(()=>e.isLoading),a=z(()=>e.error),d=z(()=>e.datasets),n=z(()=>e.activeDatasetId),r=j(!1),m=j(null),i=j(null),v=j(0),g=j(null);K(i,h=>{h&&(v.value=h.headerRow)});async function C(h){if(re(h)){e.setLoading(!0),e.setError(null);try{const t=await se(h);m.value=t,g.value=h,t.sheets.length>0&&(i.value=t.sheets[0],v.value=t.sheets[0].headerRow),r.value=!0}catch(t){e.setError(t.message)}finally{e.setLoading(!1)}return}e.setLoading(!0),e.setError(null);try{const t=await U(h);e.addDataset(t)}catch(t){e.setError(t.message)}finally{e.setLoading(!1)}}async function N(){if(!(!g.value||!i.value)){e.setLoading(!0),e.setError(null),r.value=!1;try{const h=await U(g.value,{sheetName:i.value.name,headerRow:v.value});e.addDataset(h)}catch(h){e.setError(h.message)}finally{e.setLoading(!1),x()}}}function E(){r.value=!1,x()}function x(){m.value=null,i.value=null,v.value=0,g.value=null}function w(h){l.value=!1;const t=h.dataTransfer.files;t.length>0&&C(t[0])}function c(h){const t=h.target.files;t.length>0&&C(t[0]),h.target.value=""}function k(h){e.setActiveDataset(h),u.push("/analysis")}function D(h){e.removeDataset(h)}return(h,t)=>{var A,H;return b(),y("div",le,[t[15]||(t[15]=s("div",{class:"text-center mb-8"},[s("h2",{class:"text-3xl font-bold text-gray-800 mb-4"}," データを可視化しよう "),s("p",{class:"text-gray-600"}," CSV/Excelファイルをアップロードして、豊富なチャートでデータを分析できます ")],-1)),s("div",{class:M(["drop-zone cursor-pointer mb-8",{"drag-over":l.value}]),onDragover:t[0]||(t[0]=J(p=>l.value=!0,["prevent"])),onDragleave:t[1]||(t[1]=p=>l.value=!1),onDrop:J(w,["prevent"]),onClick:t[2]||(t[2]=p=>h.$refs.fileInput.click())},[s("input",{ref:"fileInput",type:"file",accept:".csv,.xlsx,.xls,.json",class:"hidden",onChange:c},null,544),f.value?(b(),y("div",ie,[...t[5]||(t[5]=[s("div",{class:"spinner"},null,-1),s("p",{class:"text-gray-600"},"ファイルを読み込み中...",-1)])])):(b(),y("div",ae,[...t[4]||(t[4]=[O('<svg class="w-16 h-16 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg><div><p class="text-lg font-medium text-gray-700"> ファイルをドラッグ&amp;ドロップ </p><p class="text-sm text-gray-500 mt-1"> または クリックしてファイルを選択 </p></div><p class="text-xs text-gray-400"> 対応形式: CSV, Excel (.xlsx, .xls), JSON </p>',3)])]))],34),r.value?(b(),y("div",ce,[s("div",ue,[s("div",de,[t[6]||(t[6]=s("h3",{class:"text-xl font-semibold text-gray-800"},"Excelファイル設定",-1)),s("p",me,_((A=m.value)==null?void 0:A.fileName),1)]),s("div",fe,[s("div",pe,[t[7]||(t[7]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"シートを選択",-1)),s("div",he,[(b(!0),y(R,null,V((H=m.value)==null?void 0:H.sheets,p=>{var S;return b(),y("button",{key:p.name,onClick:$=>i.value=p,class:M(["p-3 border rounded-lg text-left transition-all",((S=i.value)==null?void 0:S.name)===p.name?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 hover:border-gray-300"])},[s("p",ve,_(p.name),1),s("p",xe,_(p.rowCount)+"行 × "+_(p.colCount)+"列 ",1)],10,ge)}),128))])]),i.value?(b(),y("div",ye,[s("label",be,[t[8]||(t[8]=B(" ヘッダー行を選択 ",-1)),s("span",we," (自動検出: "+_(i.value.headerRow+1)+"行目) ",1)]),W(s("select",{"onUpdate:modelValue":t[3]||(t[3]=p=>v.value=p),class:"select-box"},[(b(!0),y(R,null,V(Math.min(i.value.rowCount,20),p=>(b(),y("option",{key:p,value:p-1},_(p)+"行目 ",9,ke))),128))],512),[[X,v.value]])])):L("",!0),i.value?(b(),y("div",Ce,[t[9]||(t[9]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"プレビュー",-1)),s("div",_e,[s("table",Ne,[s("tbody",null,[(b(!0),y(R,null,V(i.value.preview,(p,S)=>(b(),y("tr",{key:S,class:M(["border-b",{"bg-primary-100 font-semibold":S===v.value,"bg-gray-50":S<v.value}])},[s("td",Ee,_(S+1),1),(b(!0),y(R,null,V(p,($,Q)=>(b(),y("td",{key:Q,class:M(["px-2 py-1 border-r truncate max-w-[150px]",{"text-gray-400":S<v.value}])},_($??""),3))),128))],2))),128))])])]),t[10]||(t[10]=s("p",{class:"text-xs text-gray-500 mt-2"},[s("span",{class:"inline-block w-3 h-3 bg-primary-100 mr-1"}),B("ヘッダー行 "),s("span",{class:"inline-block w-3 h-3 bg-gray-50 ml-3 mr-1"}),B("スキップされる行 ")],-1))])):L("",!0)]),s("div",Se,[s("button",{onClick:E,class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors"}," キャンセル "),s("button",{onClick:N,disabled:!i.value,class:M(["btn-primary",{"opacity-50 cursor-not-allowed":!i.value}])}," インポート ",10,De)])])])):L("",!0),a.value?(b(),y("div",je,[s("div",Le,[t[11]||(t[11]=s("svg",{class:"w-5 h-5 text-red-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),s("span",Me,_(a.value),1)])])):L("",!0),d.value.length>0?(b(),y("div",Re,[t[14]||(t[14]=s("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"読み込み済みデータ",-1)),s("div",Ve,[(b(!0),y(R,null,V(d.value,p=>(b(),y("div",{key:p.id,class:M(["flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",{"border-primary-500 bg-primary-50":p.id===n.value}])},[s("div",$e,[t[12]||(t[12]=s("svg",{class:"w-8 h-8 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),s("div",null,[s("p",ze,_(p.name),1),s("p",Be,[B(_(p.rowCount)+"行 × "+_(p.columns.length)+"列 ",1),p.currentSheet?(b(),y("span",Fe,_(p.currentSheet),1)):L("",!0)])])]),s("div",Te,[s("button",{onClick:S=>k(p.id),class:"btn-primary text-sm"}," 分析開始 ",8,Ae),s("button",{onClick:S=>D(p.id),class:"text-red-500 hover:text-red-700 p-2"},[...t[13]||(t[13]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,He)])],2))),128))])])):L("",!0),t[16]||(t[16]=O('<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12"><div class="bg-white rounded-lg shadow-md p-6 text-center"><div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-6 h-6 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div><h4 class="font-semibold text-gray-800 mb-2">豊富なチャート</h4><p class="text-sm text-gray-600">棒グラフ、折れ線、円グラフなど多彩な可視化</p></div><div class="bg-white rounded-lg shadow-md p-6 text-center"><div class="w-12 h-12 bg-accent-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-6 h-6 text-accent-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg></div><h4 class="font-semibold text-gray-800 mb-2">フィルター機能</h4><p class="text-sm text-gray-600">インタラクティブなデータ絞り込み</p></div><div class="bg-white rounded-lg shadow-md p-6 text-center"><div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></div><h4 class="font-semibold text-gray-800 mb-2">エクスポート</h4><p class="text-sm text-gray-600">PNG、Excel、PowerPointへ出力</p></div></div>',1))])}}};export{Ue as default};
